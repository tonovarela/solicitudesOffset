<!-- cards row 3 -->

<div>
  <ejs-grid #grid [dataSource]='solicitudes()' [filterSettings]="filterSettings " (dataBound)='dataBound()'
    [allowExcelExport]='true' AutoFitAll="true" [height]="heightGrid" allowReordering='true' [allowFiltering]=true
    allowPaging="true " allowResizing="true" allowSorting="true" [pageSettings]='pageSettings'>
    <e-columns>
      <ng-template #toolbarTemplate let-data>
        <div class="flex justify-end border-1 rounded-t-md " style="background-color: #f9fafb;;">
          
          <button
            class="mr-5 my-2 p-2 border font-bold border-slate-400 text-xs rounded-md  hover:bg-indigo-700 hover:text-white"
            (click)="tooglePendientes()">
            @if(pendientes()){
            Cerradas
            }@else{
             Pendientes
            }
          </button>
          
        </div>

      </ng-template>

      <e-column headerText='' width='80'>
        <ng-template #template let-data>
          <div class="flex  justify-center gap-3 ml-3">
            <svg (click)="mostrarSurtidoFirmas(data.id_solicitud)" class="h-5 w-5 fill-slate-500 hover:fill-indigo-700"
              fill="currentColor" version="1.1" id="Capa_1" xmlns="http://www.w3.org/2000/svg"
              xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 0 420 420" xml:space="preserve">
              <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
              <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
              <g id="SVGRepo_iconCarrier">
                <g>
                  <g>
                    <g>
                      <path
                        d="M252.877,92.823h53.791l0.005,62.757l27.271-42.343V77.743c0-2.168-0.863-4.247-2.396-5.787L261.984,2.395 C260.451,0.863,258.371,0,256.199,0H41.113C27.579,0,16.566,11.008,16.566,24.543v370.914c0,13.534,11.012,24.543,24.547,24.543 h268.283c13.533,0,24.545-11.009,24.545-24.543V290.15l-27.264,41.721l0.004,60.854H43.84V27.274h198.906v55.417 C242.746,88.29,247.281,92.823,252.877,92.823z">
                      </path>
                      <path
                        d="M364.398,195.123l-11.271-7.364c-1.84-1.201-4.303-0.686-5.506,1.154l-60.688,92.866l-11.67-7.625l60.688-92.867 c1.203-1.841,0.687-4.304-1.153-5.506l-11.271-7.365c-1.84-1.202-4.305-0.686-5.506,1.154l-90.869,139.053 c-0.386,0.591-0.607,1.274-0.643,1.979l-2.375,48.258c-0.069,1.409,0.614,2.754,1.797,3.523c1.183,0.773,2.688,0.86,3.949,0.231 l43.243-21.553c0.634-0.313,1.17-0.793,1.558-1.385l90.867-139.052C366.754,198.79,366.236,196.326,364.398,195.123z">
                      </path>
                      <path
                        d="M401.631,138.145l-40.869-26.708c-1.838-1.201-4.304-0.685-5.506,1.154l-27.563,42.179 c-1.201,1.84-0.686,4.306,1.154,5.508l40.869,26.706c1.838,1.202,4.305,0.686,5.506-1.154l27.562-42.178 C403.988,141.812,403.471,139.347,401.631,138.145z">
                      </path>
                      <path
                        d="M83.563,87.462h78c5.523,0,10-4.478,10-10s-4.477-10-10-10h-78c-5.523,0-10,4.478-10,10S78.042,87.462,83.563,87.462z">
                      </path>
                      <path
                        d="M231.563,127.462c0-5.522-4.479-10-10-10h-138c-5.523,0-10,4.478-10,10s4.477,10,10,10h138 C227.086,137.462,231.563,132.984,231.563,127.462z">
                      </path>
                      <path
                        d="M83.563,187.462h78c5.523,0,10-4.478,10-10s-4.477-10-10-10h-78c-5.523,0-10,4.478-10,10S78.042,187.462,83.563,187.462z ">
                      </path>
                      <path
                        d="M83.563,237.462h78c5.523,0,10-4.478,10-10c0-5.521-4.477-10-10-10h-78c-5.523,0-10,4.479-10,10 C73.563,232.984,78.042,237.462,83.563,237.462z">
                      </path>
                      <path
                        d="M87.796,366.694c-1.947,2.516,1.565,6.082,3.536,3.533c6.213-8.026,11.344-16.671,15.629-25.795 c2.674,1.679,6.185,1.343,9.065,0.205c4.151-1.637,7.67-4.796,11.021-7.655c1.981-1.69,4.287-4.481,7.029-4.748 c2.094-0.201,4.922,1.485,7.015,1.844c5.469,0.932,11.857-0.651,17.137-1.956c5.011-1.237,10.879-3.194,13.828-7.731 c1.763-2.712-2.568-5.216-4.317-2.521c-2.361,3.632-8.126,4.764-12.022,5.726c-4.573,1.131-9.879,2.246-14.592,1.442 c-3.552-0.604-6.425-2.752-10.077-1.125c-4.892,2.18-8.629,6.761-12.949,9.854c-1.933,1.384-4.142,2.714-6.56,2.901 c-0.995,0.077-1.806-0.288-2.48-0.896c0.532-1.234,1.06-2.474,1.563-3.725c4.876-12.104,7.081-24.396,9.344-37.146 c1.15-6.479,3.063-16.688-6.223-17.311c-8.205-0.548-15.296,11.287-17.918,17.524c-2.345,5.578-2.606,12.058-2.427,18.014 c0.111,3.712,1.447,7.566,2.432,11.404c-7.874,1.263-14.814,9.216-13.598,17.1c1.197,7.758,10.898,3.752,14.521,0.881 c3.667-2.905,4.854-6.534,4.893-10.448c0.731,1.205,1.342,2.65,1.974,4.002C99.395,349.544,94.098,358.552,87.796,366.694z M96.56,338.393c-0.74,3.298-4.913,6.554-8.199,6.858c-2.585,0.24-1.008-4.377-0.497-5.409c1.604-3.242,5.578-5.358,8.919-6.27 C96.939,335.199,96.914,336.811,96.56,338.393z M100.736,328.712c-0.851-3.976-2.032-7.969-2.338-11.583 c-0.592-6.975,0.647-14.284,4.106-20.384c2.161-3.812,6.566-9.654,11.239-10.154c4.173-0.444,1.628,9.705,1.267,11.744 c-1.117,6.294-1.914,12.541-3.471,18.763c-1.446,5.778-3.278,11.5-5.469,17.095C104.905,331.294,103.388,329.438,100.736,328.712 z">
                      </path>
                    </g>
                  </g>
                </g>
              </g>
            </svg>
            @if (usuarioService.puedeSurtir()){
            <svg xmlns="http://www.w3.org/2000/svg" (click)="surtir(data)" class="h-6 w-6 stroke-slate-500  hover:stroke-indigo-800  cursor-pointer"
              viewBox="0 0 24 24" fill="none" 
              stroke="#000000" stroke-width="1" stroke-linecap="round"
              stroke-linejoin="round">
              <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
              <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
              <g id="SVGRepo_iconCarrier">
                <line x1="2" x2="5" y1="12" y2="12"></line>
                <line x1="19" x2="22" y1="12" y2="12"></line>
                <line x1="12" x2="12" y1="2" y2="5"></line>
                <line x1="12" x2="12" y1="19" y2="22"></line>
                <circle cx="12" cy="12" r="7"></circle>
                <circle cx="12" cy="12" r="3"></circle>
              </g>
            </svg>            
          }
          </div>
        </ng-template>
      </e-column>
      <e-column field="id" headerText='id' width='80'>
        <ng-template #template let-data>
          {{data.id_solicitud}}
        </ng-template>
      </e-column>
      <e-column field='solicitante' width='120' AutoFit></e-column>
      <e-column field='op' width='100' AutoFit></e-column>
      <e-column field='estado' width='150'>
        <ng-template #template let-data>
          @if(data.id_estado==1){
          <div class="flex justify-between w-full   ">
            <span class="">{{data.estado}}</span>
            @if (usuarioService.puedeCancelar()){
              <svg fill="currentColor" (click)="mostrarModal(data)"             
              class="w-5 h-5 mr-2 hover:font-extrabold hover:text-pink-500 text-pink-400 cursor-pointer" version="1.1"
              id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"
              viewBox="0 0 512 512" xml:space="preserve">
              <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
              <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
              <g id="SVGRepo_iconCarrier">
                <g>
                  <g>
                    <path
                      d="M437.018,74.987c-99.968-99.977-262.067-99.977-362.035,0c-99.977,99.959-99.977,262.059,0,362.027 c99.968,99.977,262.067,99.977,362.035,0C536.994,337.054,536.994,174.955,437.018,74.987z M418.918,418.914 c-89.984,89.967-235.853,89.967-325.837,0c-89.967-89.975-89.967-235.844,0-325.828c89.984-89.967,235.853-89.967,325.837,0 C508.885,183.07,508.885,328.939,418.918,418.914z">
                    </path>
                  </g>
                </g>
                <g>
                  <g>
                    <path
                      d="M274.099,256.004l81.459-81.459c5.001-4.992,5.001-13.107,0-18.099c-4.992-5-13.107-5-18.099,0L256,237.905 l-81.459-81.459c-4.992-5.009-13.107-5.009-18.099,0c-5,4.992-5,13.107,0,18.099l81.459,81.459l-81.459,81.459 c-5,4.992-5,13.107,0,18.099c4.992,5.001,13.107,5.001,18.099,0L256,274.103l81.459,81.459c4.992,5,13.107,5,18.099,0 c5.001-4.992,5.001-13.107,0-18.099L274.099,256.004z">
                    </path>
                  </g>
                </g>
              </g>
            </svg>
            }
          


          </div>
          }@else{
          <div [class.text-pink-500]="data.id_estado==3" [class.text-gray-700]="data.id_estado==2">{{data.estado}}</div>
          }

        </ng-template>
      </e-column>
      <e-column field='componente' width='150'></e-column>
      <e-column field='cantidad' width='100'>
        <ng-template #template let-data>
          {{data.cantidad | number}}
          </ng-template>  
      </e-column>
      <e-column field='cantidadSurtida' headerText="surtido" width='100'>
        <ng-template #template let-data>
          {{data.cantidadSurtida | number}}
        </ng-template>
      </e-column>
      <e-column field='maquina' width='150'></e-column>
      <e-column field='fecha_registro' width='150'>
        <ng-template #template let-data>
          {{data.fecha_registro | date: 'dd-MM-yyyy'}}
        </ng-template>
      </e-column>
      <e-column field='fecha_entrega' width='150'>
        <ng-template #template let-data>
          {{data.fecha_entrega | date: 'dd-MM-yyyy hh:mm a'}}
        </ng-template>
      </e-column>
    </e-columns>
    <ng-template #emptyRecordTemplate>
      custom text
    </ng-template>
    
  </ejs-grid>

</div>

<a routerLink="/nuevo" type="button"
  class="text-white fixed bottom-4 right-4 bg-blue-700 hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 font-medium rounded-full text-sm p-4 text-center inline-flex items-center me-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800">
  <svg class="w-4 h-4 " viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
    <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
    <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
    <g id="SVGRepo_iconCarrier">
      <path d="M4 12H20M12 4V20" stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
      </path>
    </g>
  </svg>
</a>


<p-dialog [modal]="true" showHeader="false" [(visible)]="modalCancelacion" closable="false" closeOnEscape="false"
  [style]="{ width: '50rem','border-radius':'100px' }">
  <div class="flex flex-col items-end mt-5 w-full p-0">
    <div class="relative w-full ">
      <textarea [(ngModel)]="motivoCancelacion"
        class="peer h-full min-h-[150px] w-full resize-none rounded-md border border-blue-gray-200 border-t-transparent bg-transparent px-3 py-3 font-sans text-sm font-normal text-blue-gray-700 outline outline-0 transition-all placeholder-shown:border placeholder-shown:border-blue-gray-200 placeholder-shown:border-t-blue-gray-200 focus:border-2 focus:border-gray-900 focus:border-t-transparent focus:outline-0 disabled:resize-none disabled:border-0 disabled:bg-blue-gray-50"
        placeholder=" "></textarea>
      <label
        class="before:content[' '] after:content[' '] pointer-events-none absolute left-0 -top-1.5 flex h-full w-full select-none text-[11px] font-normal leading-tight text-blue-gray-400 transition-all before:pointer-events-none before:mt-[6.5px] before:mr-1 before:box-border before:block before:h-1.5 before:w-2.5 before:rounded-tl-md before:border-t before:border-l before:border-blue-gray-200 before:transition-all after:pointer-events-none after:mt-[6.5px] after:ml-1 after:box-border after:block after:h-1.5 after:w-2.5 after:flex-grow after:rounded-tr-md after:border-t after:border-r after:border-blue-gray-200 after:transition-all peer-placeholder-shown:text-sm peer-placeholder-shown:leading-[4.1] peer-placeholder-shown:text-blue-gray-500 peer-placeholder-shown:before:border-transparent peer-placeholder-shown:after:border-transparent peer-focus:text-[11px] peer-focus:leading-tight peer-focus:text-gray-900 peer-focus:before:border-t-2 peer-focus:before:border-l-2 peer-focus:before:border-gray-900 peer-focus:after:border-t-2 peer-focus:after:border-r-2 peer-focus:after:border-gray-900 peer-disabled:text-transparent peer-disabled:before:border-transparent peer-disabled:after:border-transparent peer-disabled:peer-placeholder-shown:text-blue-gray-500">
        Motivo por el cual cancela la solicitud
      </label>
    </div>
  </div>


  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-2 ">
      <button [disabled]="cancelandoSolicitud" class="bg-gray-300 rounded-md  p-2"
        (click)="cerrarModal()">Cancelar</button>
      <button [disabled]="cancelandoSolicitud"
        class="bg-indigo-700 text-white rounded-md disabled:bg-indigo-700/65  p-2" (click)="cerrarSolicitud()">
        <i *ngIf="cancelandoSolicitud" class="fas fa-spinner fa-spin"></i>
        Guardar
      </button>
    </div>
  </ng-template>
</p-dialog>

<p-dialog [modal]="true" showHeader="false" [(visible)]="modalFirma" closable="false" closeOnEscape="false"
  [style]="{ width: '78rem','border-radius':'100px' }">


  @if(firmas().length==0 && !cargandoFirmas()){
  <div class="flex justify-center items-center h-64 border mt-5">
    <div class="flex flex-col items-center">
      <i class="fas fa-signature text-6xl text-gray-300"></i>
      <span class="text-gray-300">No hay firmas registradas</span>
    </div>
  </div>
  }
  @if(firmas().length>0){
  <section class="container mx-auto p-6 font-sans">
    <div class="w-full   rounded-lg shadow-md">
      <div class="w-full overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr
              class="text-md font-semibold  text-left text-white bg-slate-700 uppercase   ">
              <th class="px-4 ">Firma</th>
              <th class="px-4 ">Cantidad</th>
              <th class="px-4 ">Entrego</th>
              <th class="px-4 ">Fecha registro</th>
            </tr>
          </thead>
          <tbody class="bg-white">
            @for(firma of firmas();track firma.id){
            <tr class="text-gray-700 border">
              <td class="px-4 py-1 ">
                <div class="flex items-center  justify-center">
                  <div class=" w-24 h-24 mr-3 rounded-full md:block">
                    <img class="object-cover w-full p-2 h-full rounded-sm border" [src]="firma.firma" alt=""
                      loading="lazy" />
                  </div>
                </div>
              </td>
              <td class="px-4 py-1 text-ms font-semibold  text-center">{{firma.cantidad | number}}</td>
              <td class="">
                <div class="px-2 py-1 font-semibold flex flex-col  justify-items-center items-center rounded-sm"> 
                  <img class="w-9 h-9 rounded-full" [src]="firma.personal" alt="" loading="lazy" />                
                  {{firma.usuario}} 
                </div>
                
              </td>
              <td class="px-4 py-1 text-sm  text-center">{{firma.fecha_registro | date:'dd-MM-yyyy hh:mm'}}</td>
            </tr>
            }
          </tbody>
        </table>
      </div>
    </div>
  </section>
  }






  <ng-template pTemplate="footer">
    <div class="flex justify-end gap-2 ">
      <button class="bg-indigo-700 text-white rounded-md disabled:bg-indigo-700/65  p-2" (click)="cerrarModalFirmas()">
        Cerrar
      </button>
    </div>
  </ng-template>
</p-dialog>